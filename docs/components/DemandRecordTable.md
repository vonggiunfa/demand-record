# DemandRecordTable 组件需求逻辑文档

## 1. 组件概述

DemandRecordTable 是一个用于记录和管理需求的表格组件，它提供了简洁的用户界面和完整的功能，帮助用户高效地管理项目需求。组件采用了与系统中其他表格组件一致的设计风格，但功能更加专注于需求管理。

## 2. 数据结构设计

```typescript
interface DemandRecord {
  id: string;         // 内部唯一标识
  demandId: string;   // 需求ID（用户可编辑）
  description: string; // 需求描述（用户可编辑）
  createdAt: Date;    // 创建时间（自动生成，不可编辑）
}
```

## 3. 功能列表

### 3.1 核心功能

- **数据显示**：以表格形式展示需求记录
- **行选择**：通过复选框选择单行或多行记录
- **全选/取消全选**：通过表头复选框操作所有行
- **数据编辑**：
  - 只有被选中的行才能编辑【需求ID】和【需求描述】
  - 【创建时间】在创建记录时自动生成，不可编辑
- **数据操作**：
  - 新增：添加新的需求记录
  - 删除：删除选中的需求记录

### 3.2 数据导入导出

- **CSV导出**：
  - 支持导出所有数据或仅导出选中数据
  - 导出为标准CSV格式，兼容Excel等电子表格软件
  - 自动处理特殊字符（逗号、引号、换行符等）
- **CSV导入**：
  - 支持从本地导入CSV文件
  - 兼容不同格式的日期字符串
  - 验证CSV格式，确保数据完整性

### 3.3 辅助功能

- **状态反馈**：通过Toast提示操作结果
- **键盘导航**：支持Enter键在输入框之间切换

## 4. 用户界面设计

### 4.1 主要区域

- **操作工具栏**：
  - 新增按钮
  - 删除按钮（带选中计数）
  - 导入CSV按钮
  - 导出CSV按钮

- **表格区域**：
  - 固定表头（悬浮时保持可见）
  - 固定第一列（选择列）
  - 行交互效果（悬浮高亮、选中状态）
  - 自定义滚动条

### 4.2 特殊UI处理

- **需求描述**：使用单行输入框，保持界面简洁统一
- **创建时间**：只读显示，不提供编辑控件
- **响应式设计**：适配不同屏幕大小

## 5. 性能优化

- **记忆化渲染**：使用React.memo减少不必要的重新渲染
- **事件处理优化**：使用useCallback防止函数重建
- **滚动性能优化**：滚动时禁用指针事件，改善大数据量时的滚动体验

## 6. 用户交互流程

### 6.1 添加新需求

1. 点击"新增"按钮
2. 系统创建新行并自动选中
3. 系统自动生成当前时间作为创建时间
4. 用户输入需求ID和需求描述

### 6.2 编辑需求

1. 用户选中需要编辑的行（勾选复选框）
2. 系统启用该行的输入控件（仅限需求ID和需求描述）
3. 用户编辑需求ID或需求描述
4. 修改自动保存到组件状态

### 6.3 删除需求

1. 用户选中需要删除的行
2. 点击"删除"按钮
3. 系统移除选中的行并提示成功

### 6.4 数据导入导出

1. **导出流程**：
   - 用户点击"导出全部"或"导出所选"
   - 系统生成CSV文件并触发下载
   - 提示导出成功

2. **导入流程**：
   - 用户点击"导入CSV"
   - 选择本地CSV文件
   - 系统解析文件内容
   - 如有现有数据，提示是否替换
   - 数据导入完成后提示成功

## 7. 错误处理与边界情况

- **空数据处理**：当无数据时显示提示信息，引导用户添加数据
- **文件格式验证**：导入时验证CSV格式，防止导入格式错误的文件
- **异常恢复**：导入失败时保留现有数据，不影响当前状态
- **日期解析错误**：导入时对无效日期使用当前日期作为默认值

## 8. 未来可扩展方向

- **本地存储**：添加localStorage支持，防止页面刷新数据丢失
- **筛选排序**：添加按需求ID、创建时间筛选和排序功能
- **需求状态**：增加状态字段，跟踪需求完成情况
- **搜索功能**：添加全文搜索，快速定位需求
- **数据同步**：添加与后端API集成，实现数据持久化

## 9. 实现注意事项

- **使用了Memo优化**：通过React.memo减少不必要的组件重渲染
- **使用useCallback和useRef**：避免函数重建和对DOM的直接操作
- **CSV处理逻辑**：处理了引号内的逗号，确保CSV格式正确
- **键盘快捷键**：支持Enter键在输入框之间导航
- **行选择机制**：通过Set数据结构管理选中行的状态
- **响应式设计**：在不同屏幕尺寸下保持良好的用户体验

## 10. 测试要点

- **功能测试**：
  - 添加、编辑、删除功能
  - 行选择和全选功能
  - 导入导出功能
- **兼容性测试**：
  - 不同浏览器下的表现
  - 响应式设计的适配情况
- **边界条件测试**：
  - 空数据情况
  - 大量数据情况
  - 特殊字符处理 